<html>
<head>
<title>API</title>
<script src="lib/js/jquery.js"></script>
<script src="lib/js/underscore.js"></script>
<script src="lib/js/underscore.db.js"></script>
<style>
table, table th, table td
{
    border: 1px solid black;
    border-collapse: collapse;
}

</style>
</head>
<body>
<script>
var db = {
  posts: [
    {id: 1, body: 'foo', views: 10, published: false},
    {id: 2, body: 'bar', views: 20, published: true}
  ],
  comments: [
    {id: 1, body: 'baz', postId: 1},
    {id: 2, body: 'qux', postId: 2}
  ]
}

// var post            = _.get(db.posts, 1);

// var insertedPost    = _.insert(db.posts, {body: 'new post', published: false});

// var updatedPost     = _.update(db.posts, 1, {published: true});

// var removedPost     = _.remove(db.posts, 1);

// var removedComments = _.removeWhere(db.comments, {postId: 1});

function display(db, name)
{
    var result = "";
        // result += "<table>";
    var table = db[name];
    var keys = []
    var rows = []


    result += "<tr>"
    for (var key1 in table) {
        if (table.hasOwnProperty(key1)) {
            var row = table[key1];
            for (var key2 in row) {
                if (row.hasOwnProperty(key2)) {
                    result += "<th>";
                    result += key2;
                    result += "</th>";
                    keys.push(key2)
                }
            }
            // rows.push(row)
        }
        break;
    }
    result += "</tr>"

    for (var key in table)
    {
        result += "<tr>";
        if (table.hasOwnProperty(key1))
        {
            var row = table[key];
            for (var field in row)
            {
                result += "<td><input row='"+row.id+"' field='"+field+"' value='"+row[field]+"'/></td>";
            }
        }
        result += "</tr>";
    }

    // for (var key1 in table) {
    //     result += "<tr>";
    //     if (table.hasOwnProperty(key1)) {
    //         var row = table[key1];
    //         for (var key2 in row) {
    //             if (row.hasOwnProperty(key2)) {
    //                 result += "<td><input row='3' field='"+key2+"' value=''/></td>";
    //             }
    //         }
    //     }
    //     result += "</tr>";
    //     break;
    // }

    // result += "</table>";
    return result;
}

$(function()
{
    var table = "posts";
    $("table").html(display(db, table));
    $("pre").text(JSON.stringify(db[table]))
    $("input").on("keyup", function()
    {
        var post = _.get(db[table], parseInt($(this).attr("row")));


        if (post)
        {
            var data = {};
            data[$(this).attr("field")] = $(this).val();

            _.update(db[table], parseInt($(this).attr("row")), data);
            $("table").html(display(db, table));
        }
        else
        {
            _.insert(db.posts, {});
            $("table").html(display(db, table));


        }
        $("pre").html(JSON.stringify(db[table]));
        $(this).focus()

    })
})

</script>
<table></table>
<pre>


</pre>
<!--
<i class="icon-cut" />

<i class="icon-paste" />
<i class="icon-save" />
<i class="icon-font" />
<i class="icon-file" />
<i class="icon-text-width" />
<i class="icon-text-height" />


<i class="icon-link" />
<i class="icon-clipboard" />
<i class="icon-" />
<i class="icon-" />
<i class="icon-undo" />
<i class="icon-repeat" />
-->
<!--

<div class='menu'>Make</div>
<div class='pane'>
<table class='controls'>
<tr>
<td><div id='databases'><select></select></div></td>
<td><button id='adddatabase'>Add Database</button></td>
<td><button id='renamedatabase'>Rename Database</button></td>
<td><button id='removedatabase'>Remove Database</button></td>
<td></td>
<td></td>
</tr>
<tr>
<td><div id='tables'><select></select></div></td>
<td><button id='addtable'>Add Table</button></td>
<td><button id='renametable'>Rename Table</button></td>
<td><button id='removetable'>Remove Table</button></td>
<td><button id='truncatetable'>Clear Table</button></td>
<td></td>
</tr>
<tr>
<td><div id='columns'><select></select></div></td>
<td><button id='addcolumn'>Add Column</button></td>
<td><button id='renamecolumn'>Rename Column</button></td>
<td><button id='removecolumn'>Remove Column</button></td>
<td><button id='showtable'>Show Table</button></td>
<td><button id='showcolumns'>Show Columns</button></td>
<td>
<select id="datatype">
<option></option>
<optgroup label="number">
<option>boolean</option>
<option>int</option>
<option>decimal</option>
</optgroup>
<optgroup label="text">
<option>char</option>
<option>varchar</option>
<option>text</option>
<option>blob</option>
</optgroup>
<optgroup label="date &amp; time">
<option>date</option>
<option>datetime</option>
<option>timestamp</option>
<option>time</option>
<option>year</option>
</optgroup>
</select>
</td>
<td><input id="datalength" type='text'></td>
</tr>
</table>
<table class='controls'>
<form>
<tr>
<td>
<select name="command" id="command">
<option name='SELECT' id='SELECT' value='SELECT'>SELECT</option>
<option name='CREATE' id='CREATE' value='CREATE'>CREATE</option>
<option name='ALTER' id='ALTER' value='ALTER'>ALTER</option>
<option name='INSERT' id='INSERT' value='INSERT'>INSERT</option>
<option name='DELETE' id='DELETE' value='DELETE'>DELETE</option>
<option name='DROP' id='DROP' value='DROP'>DROP</option>
<option name='TRUNCATE' id='TRUNCATE' value='TRUNCATE'>TRUNCATE</option>
</select>
</td>
<td></td>
<td colspan=3><select id="aggregate"><option></option><option>Avg</option><option>Count</option><option>Count(*)</option><option>Count Distinct</option><option>First</option><option>Last</option><option>Max</option><option>Min</option><option>Ucase</option><option>Upper</option><option>Lcase</option><option>Lower</option><option>Mid</option><option>Len</option><option>Round</option><option>Now</option><option>Format</option></select></td>
<td><input type="checkbox" name="limited" id="limited" checked="true"><label for="limited">Limit to</label></td>
<td><input type="checkbox" name="ordered" id="ordered"><label for="ordered">Sort by</label></td>
<td><input type="checkbox" name="grouped" id="grouped"><label for="grouped">Group on</label></td>
</tr>
<tr>
<td><input type="checkbox" name="distinct" id="distinct"><label for="distinct">Distinct</label></td>
<td><select class="columns" name="tables" id="tables" multiple></select></td>
<td><select class="columns" name="a_cols[]" id="a_cols" multiple></select></td>
<td>
<div class="columns" id="toggle">
<ul>
<li><input type="button" class="tog" id="addallcols" value="&raquo;"></li>
<li>&nbsp;</li>
<li><input type="button" class="tog" id="remallcols" value="&laquo;"></li>
</ul>
</div>
</td>
<td><select class="columns" name="b_cols[]" id="b_cols" multiple></select></td>
<td><input type="number" name="limit" id="limit" value="30" /></td>
<td><select name="order" id="order" class="param" /></td><select name="direction" id="direction"><option /><option value=ASC>ASC</option><option value=DESC>DESC</option></select>
<td><select name="group" id="group" class="param" /></td>
</tr>
<tr>
<td><input type="checkbox" name="paramed[]" id="paramed"></td>
<td><label for="paramed"><select name="bool[]" id="bool"><option value="WHERE">WHERE</option></select></label></td>
<td><select name="param[]" class="param" /></td>
<td>
<select name="operator[]" id="operator" onchange="toggle_operator(this)">
<option></option><option value="= ">= </option><option value="!=">!=</option><option value="> ">> </option><option value="< ">< </option><option value=">=">>=</option><option value="<="><=</option><option value=BETWEEN>BETWEEN</option><option value=IN>IN</option><option value=LIKE>LIKE</option>
</select>
</td>
<td><span id="value_span"><input type=text name="values[]" id='values'></span></td>
<td><input type="reset" value="Clear" onclick="$('#results').html(''); $('#query').html(''); clear_rows()" /></td>
</tr>
<tr><td><input type="button" value="Add" onclick="add_row(this)" /></td></tr>
</form>
</table>
</div>
<div class='menu'>File</div>
<div class='pane'>
<table class='controls'>
<tr>
<td rowspan="3"><select id="filechoice" size="4"></select></td>
<td>
<button onclick="$('#uploads').click()" style="padding: 3px; ">Choose File</button>
<form action="functions.php" method="post" enctype="multipart/form-data" id="fileupload" target="target" style="display: none;">
<input name="uploads" id="uploads" type="file" size="0" multiple>
<input type="hidden" name="mode" value="3">
<input type="submit" name="uploadsubmit" id="uploadsubmit" value="Upload">
<iframe id="target" name="target"></iframe>
</form>
</td>
<td><input type="text" id="filename" placeholder="File Name"></td>
<td><button id="export" onclick="export_csv()">Export</button></td>
</tr>
<tr>
<td><button onclick="$('#uploadsubmit').click()">Upload</button></td>
<td><select id="exportformat"><option>Extension:</option><option value=".csv">CSV</option><option value=".html">HTML</option><option value=".xml">XML</option><option value=".json">JSON</option></select></td>
<td><button id="save" onclick="save()">Save</button></td>
</tr>
<tr>
<td><button class="control">Parse</button></td>
<td><input type="text" id="exportdelimit" placeholder="Delimiter"></td>
<td><button class="control">Delete</button></td>
</tr>
</table>
</div>
<div class='menu'>Find</div>
<div class='pane'>

<input class="control" type="text" id="filter" placeholder="Filter...">
<select class="columns" name="a_cols1[]" id="a_cols" multiple size="4"></select>
<button class="control" id="addallcols">&gt;&gt;</button>
<select class="columns" name="b_cols1[]" id="b_cols" multiple size="4"></select>
<button class="control">Selected Cells Only</button>
<button class="control">Regex</button>
<input type="checkbox" id="firstrow">Use First Row
<button class="control" id="remallcols">&lt;&lt;</button>
</div>
<div class='menu'>View</div>
<div class='pane'>
<button class="control" id="getAdjacencyList">Adjacency List</button>
<button class="control" id="getAdjacencyMatrix">Adjacency Matrix</button>
<button class="control" id="popup">Popup</button>
<button class="control" id="makepiechart">Pie Chart</button>
<button class="control" id="makescatterplot">Scatterplot</button>
</div>
-->
</body>
</html>
